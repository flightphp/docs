# Ответы

Flight помогает генерировать часть заголовков ответа для вас, но вы контролируете большую часть того, что вы отправляете обратно пользователю. Иногда вы можете получить доступ к объекту `Response` напрямую, но в большинстве случаев вам потребуется использовать экземпляр `Flight` для отправки ответа.

## Отправка базового ответа

Flight использует `ob_start()` для буферизации вывода. Это означает, что вы можете использовать `echo` или `print`, чтобы отправить ответ пользователю, и Flight захватит его и отправит обратно пользователю с соответствующими заголовками.

```php

// Это отправит "Hello, World!" в браузер пользователя
Flight::route('/', function() {
	echo "Hello, World!";
});

// HTTP/1.1 200 OK
// Content-Type: text/html
//
// Hello, World!
```

Также вы можете вызвать метод `write()` для добавления данных в тело ответа.

```php

// Это отправит "Hello, World!" в браузер пользователя
Flight::route('/', function() {
	// длинное, но иногда полезное решение
	Flight::response()->write("Hello, World!");

	// если вы хотите получить тело, установленное на этом этапе
	// можно сделать это следующим образом
	$body = Flight::response()->getBody();
});
```

## Коды состояния

Вы можете установить код состояния ответа, используя метод `status`:

```php
Flight::route('/@id', function($id) {
	if($id == 123) {
		Flight::response()->status(200);
		echo "Hello, World!";
	} else {
		Flight::response()->status(403);
		echo "Forbidden";
	}
});
```

Чтобы получить текущий код состояния, вы можете использовать метод `status` без аргументов:

```php
Flight::response()->status(); // 200
```

## Установка заголовка ответа

Вы можете установить заголовок, такой как тип содержимого ответа, используя метод `header`:

```php

// Это отправит "Hello, World!" в браузер пользователя в виде обычного текста
Flight::route('/', function() {
	Flight::response()->header('Content-Type', 'text/plain');
	echo "Hello, World!";
});
```



## JSON

Flight поддерживает отправку JSON и JSONP ответов. Чтобы отправить JSON-ответ, передайте некоторые данные для кодирования JSON:

```php
Flight::json(['id' => 123]);
```

### JSONP

Для запросов JSONP вы можете дополнительно передать имя параметра запроса, которое используется для определения функции обратного вызова:

```php
Flight::jsonp(['id' => 123], 'q');
```

Таким образом, при выполнении GET-запроса с использованием `?q=my_func`, вы должны получить вывод:

```javascript
my_func({"id":123});
```

Если вы не передаете имя параметра запроса, по умолчанию будет использоваться `jsonp`.

## Перенаправление на другой URL

Вы можете перенаправить текущий запрос, используя метод `redirect()` и передавая новый URL:

```php
Flight::redirect('/new/location');
```

По умолчанию Flight отправляет код состояния HTTP 303 ("See Other"). Вы также можете установить пользовательский код:

```php
Flight::redirect('/new/location', 401);
```

## Остановка

Вы можете остановить фреймворк в любой момент, вызвав метод `halt`:

```php
Flight::halt();
```

Вы также можете указать дополнительный код состояния и сообщение `HTTP`:

```php
Flight::halt(200, 'Be right back...');
```

Вызов `halt` приведет к отмене любого содержимого ответа до этого момента. Если вы хотите остановить фреймворк и вывести текущий ответ, используйте метод `stop`:

```php
Flight::stop();
```

## HTTP-кэширование

Flight предоставляет встроенную поддержку кэширования на уровне HTTP. Если условие кэширования выполнено, Flight вернет ответ HTTP `304 Not Modified`. В следующий раз, когда клиент запросит тот же ресурс, ему будет предложено использовать версию, кэшированную локально.

### Кэширование на уровне маршрута

Если вы хотите кэшировать весь свой ответ, вы можете использовать метод `cache()` и передать время кэширования.

```php

// Это закэширует ответ на 5 минут
Flight::route('/news', function () {
  Flight::cache(time() + 300);
  echo 'Этот контент будет кэшироваться.';
});

// Кроме того, вы можете использовать строку, которую вы бы передали
// методу strtotime()
Flight::route('/news', function () {
  Flight::cache('+5 minutes');
  echo 'Этот контент будет кэшироваться.';
});
```

### Последнее изменение

Вы можете использовать метод `lastModified` и передать метку UNIX времени, чтобы установить дату и время последнего изменения страницы. Клиент будет продолжать использовать свой кэш до тех пор, пока значение последнего изменения не изменится.

```php
Flight::route('/news', function () {
  Flight::lastModified(1234567890);
  echo 'Этот контент будет кэшироваться.';
});
```

### ETag

Кэширование `ETag` аналогично `Last-Modified`, за исключением того, что вы можете указать любой идентификатор для ресурса:

```php
Flight::route('/news', function () {
  Flight::etag('my-unique-id');
  echo 'Этот контент будет кэшироваться.';
});
```

Имейте в виду, что вызов `lastModified` или `etag` установит и проверит значение кэша. Если значение кэша одинаково между запросами, Flight немедленно отправит ответ `HTTP 304` и прекратит обработку.